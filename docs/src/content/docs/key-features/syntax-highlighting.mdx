---
title: Syntax Highlighting
---

import ConfigVariants from '@components/ConfigVariants.astro'
import PropertySignature from '@components/PropertySignature.astro'
import { Tabs, TabItem } from '@astrojs/starlight/components'

Expressive Code's default syntax highlighter is Shiki, which uses the same engine as VS Code to provide accurate syntax highlighting for over 100 languages.

:::tip[No installation required]
These features are provided by `@expressive-code/plugin-shiki`, which is installed & enabled by default in all framework integrations. You can start using it right away in your documents!
:::

## Usage in markdown / MDX

### Regular syntax highlighting

To get syntax highlighting for your code blocks, wrap them in code fences (using three or more backticks) and ensure that your opening code fences include a language identifier, e.g. `js` for JavaScript:

````md title="example.md" ins=/^([^a-z]{3}.*)/
```js
console.log('This code is syntax highlighted!')
```
````

The rendered result looks like this:
```js
console.log('This code is syntax highlighted!')
```

### Rendering ANSI escape sequences

Expressive Code supports rendering a subset of [ANSI escape sequences](https://en.wikipedia.org/wiki/ANSI_escape_code). This can be useful for displaying formatted terminal output in your documentation.

To enable this feature for a code block, set its language identifier in the opening code fence to `ansi`. You can then use the following ANSI escape sequences:

````md title="ansi-example.md" ins="ansi"
```ansi
ANSI colors:
- Regular: [31mRed[0m [32mGreen[0m [33mYellow[0m [34mBlue[0m [35mMagenta[0m [36mCyan[0m
- Bold:    [1;31mRed[0m [1;32mGreen[0m [1;33mYellow[0m [1;34mBlue[0m [1;35mMagenta[0m [1;36mCyan[0m
- Dimmed:  [2;31mRed[0m [2;32mGreen[0m [2;33mYellow[0m [2;34mBlue[0m [2;35mMagenta[0m [2;36mCyan[0m

256 colors (showing colors 160-177):
[38;5;160m160 [38;5;161m161 [38;5;162m162 [38;5;163m163 [38;5;164m164 [38;5;165m165[0m
[38;5;166m166 [38;5;167m167 [38;5;168m168 [38;5;169m169 [38;5;170m170 [38;5;171m171[0m
[38;5;172m172 [38;5;173m173 [38;5;174m174 [38;5;175m175 [38;5;176m176 [38;5;177m177[0m

Full RGB colors:
[38;2;34;139;34mForestGreen - RGB(34, 139, 34)[0m

Text formatting: [1mBold[0m [2mDimmed[0m [3mItalic[0m [4mUnderline[0m
```
````

Result:

```ansi
ANSI colors:
- Regular: [31mRed[0m [32mGreen[0m [33mYellow[0m [34mBlue[0m [35mMagenta[0m [36mCyan[0m
- Bold:    [1;31mRed[0m [1;32mGreen[0m [1;33mYellow[0m [1;34mBlue[0m [1;35mMagenta[0m [1;36mCyan[0m
- Dimmed:  [2;31mRed[0m [2;32mGreen[0m [2;33mYellow[0m [2;34mBlue[0m [2;35mMagenta[0m [2;36mCyan[0m

256 colors (showing colors 160-177):
[38;5;160m160 [38;5;161m161 [38;5;162m162 [38;5;163m163 [38;5;164m164 [38;5;165m165[0m
[38;5;166m166 [38;5;167m167 [38;5;168m168 [38;5;169m169 [38;5;170m170 [38;5;171m171[0m
[38;5;172m172 [38;5;173m173 [38;5;174m174 [38;5;175m175 [38;5;176m176 [38;5;177m177[0m

Full RGB colors:
[38;2;34;139;34mForestGreen - RGB(34, 139, 34)[0m

Text formatting: [1mBold[0m [2mDimmed[0m [3mItalic[0m [4mUnderline[0m
```

## Supported languages

Out of the box, over 100 languages are supported, including JavaScript, TypeScript, HTML, CSS, Astro, Markdown, MDX, JSON, YAML, and many more. You can find a [list of all language identifiers](https://github.com/antfu/textmate-grammars-themes/blob/main/packages/tm-grammars/README.md) on GitHub.

:::tip
You can support more languages by providing their grammars to the `langs` option. See the [configuration](#configuration) section for examples on how to do this.
:::

## Differences to Shiki's HTML output

If you're migrating an existing site to Expressive Code that uses custom CSS to modify syntax-highlighted code, please note that the HTML output and classes generated by Expressive Code do not match the default output generated by Shiki.

Instead, the syntax tokens generated by Shiki are converted to Expressive Code's own annotations (`InlineStyleAnnotation`), which provide efficient multi-theme support and can be combined with other annotations.

If you need additional classes on some HTML elements, consider [writing your own plugin](/guides/developing-plugins/) to modify the output as needed.

## Configuration

When using this plugin through a framework integration, you can configure it by passing options to the integration.

Here are configuration examples for common scenarios:

<ConfigVariants
  imports={`
    // Add this if you want to load a custom language grammar from a file:
    // import fs from 'node:fs'
  `}
  settings={`
    // You can use any of the themes bundled with Shiki by name,
    // specify a path to JSON theme file, or pass an instance
    // of the \`ExpressiveCodeTheme\` class here:
    themes: ['dracula', 'solarized-light'],
    shiki: {
      // You can pass additional plugin options here,
      // e.g. to load custom language grammars:
      langs: [
        // import('./some-exported-grammar.mjs'),
        // JSON.parse(fs.readFileSync('./some-json-grammar.json', 'utf-8'))
      ],
    },
  `}
/>

### Available plugin options

You can pass the following options to the plugin:

#### langs

<PropertySignature>
- Type: LanguageInput[]
</PropertySignature>

A list of additional languages that should be available for syntax highlighting.

You can pass any of the language input types supported by Shiki, e.g.:
- `import('./some-exported-grammar.mjs')`
- `JSON.parse(fs.readFileSync('./some-json-grammar.json', 'utf-8'))`

See the [Shiki documentation](https://shiki.style/guide/load-lang) for more information.

:::note
When using this option, Expressive Code automatically ensures that all bundled default languages are still available. You don't need to add Shiki's `bundledLanguages` manually to this array.
:::

#### transformers

<PropertySignature>
- Type: ShikiTransformer[]
</PropertySignature>

An optional list of Shiki transformers that should be called during syntax highlighting.

This option allows you to add transformers that modify the tokens produced by Shiki to improve syntax highlighting, e.g. by applying bracket matching or changing the color of certain tokens.

:::caution[Experimental option with very limited support]
This option currently only supports transformers that meet all of the following criteria:

- They do not contain any hooks except `preprocess` and `tokens`.
- They do not attempt to modify the text contents of a code block.

As a result, **most popular transformers will not work**, including `@shikijs/transformers` and `@shikijs/twoslash`, and attempting to add them will throw an error. This is expected behavior to inform you about the current limitations, and not a bug in any of the involved projects. Please do not report such errors to other authors, as they will be unable to help.

The current limitations exist because Expressive Code's architecture is not yet compatible with Shiki's transformers API, which has been introduced long after the release of Expressive Code. We will improve the supported transformer features in future releases to close the gap.
:::

:::tip
If you have a transformer that does useful work in its `preprocess` and `tokens` hooks without modifying any text contents, but it gets rejected by Expressive Code due to other hooks being present, you can create a custom transformer that wraps the original transformer and only exposes the supported hooks.
:::

### Using another syntax highlighter

If you want to use another syntax highlighter, you can set `shiki: false` in the [configuration](#configuration) to prevent the default highlighter from being loaded. You can then write a plugin for the new syntax highlighter and add it to the `plugins` array.

:::tip
If you publish your own plugin package to NPM, please [let us know on GitHub](https://github.com/expressive-code/expressive-code/issues). We'd love to showcase high-quality community plugins.
:::
